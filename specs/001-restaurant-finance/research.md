# Research Notes â€” Lakehouse Restaurant Finance MVP

## Decisions

1. Stack selection (frontend)

- Decision: Next.js 14 with TypeScript, Tailwind CSS, D3.js, TanStack Query.
- Rationale: Next.js app router suits SPA-like dashboard with server data fetching; Tailwind accelerates layout; D3.js handles custom KPI and breakdown charts; TanStack Query manages caching and background refetch with freshness indicators.
- Alternatives considered: Chart.js/Recharts (faster start, less flexible for custom drill-down visuals); kept D3 for bespoke breakdowns.

2. Stack selection (backend)

- Decision: Go 1.22 with chi router, sqlc/pgx, testify; REST JSON APIs.
- Rationale: Go is performant, simple for CSV/ETL; chi is lightweight; sqlc enforces type-safe queries; REST keeps interoperability for exports and frontend.
- Alternatives considered: gRPC (overkill for single frontend); Gin/Echo (similar; chose chi for minimalism).

3. Storage and deployment

- Decision: PostgreSQL 15 in Docker Compose; local filesystem for uploaded CSV/exports; migrations via SQL (e.g., goose/tern style) generated by sqlc schema.
- Rationale: Postgres suited for analytical aggregations and JSON fields; Docker for reproducible local dev.
- Alternatives considered: SQLite (simpler, but weaker for concurrent imports and JSON ops); S3/GCS for blobs (not needed for MVP).

4. Imports and anomaly handling

- Decision: CSV import pipeline with saved column mappings, idempotent upserts keyed by file hash + business keys (date, channel, register). Anomalies logged per row with type (missing channel, negative totals, bad date) and surfaced via import log.
- Rationale: Constitution requires no silent drops and anomaly surfacing; file-hash idempotency avoids duplicates.
- Alternatives considered: Schema-on-read via DuckDB (flexible, but mapping persistence simpler with explicit columns + sqlc).

5. KPI computation

- Decision: Daily aggregates materialized into summary tables (date, channel, daypart) after imports; freshness timestamp persisted.
- Rationale: Performance target <1s for 30 days; pre-aggregations reduce query cost.
- Alternatives considered: On-the-fly aggregation (simpler, but slower under repeated dashboard loads).

6. Security and roles

- Decision: App-native RBAC (Owner/Admin, Manager, Accountant, Viewer) enforced in backend; JWT or session cookie; TLS expected at ingress; audit trail for imports and exports.
- Rationale: Constitution requires least privilege and audit for significant actions; JWT suits SPA; cookies OK if behind same-site frontend.
- Alternatives considered: External IdP/SSO (overhead for single-venue MVP).

7. Timezone and locale

- Decision: Default timezone Australia/Brisbane; timestamps stored UTC with zone displayed; currency AUD; date formatting en-AU.
- Rationale: Single venue in Brisbane; prevents drift; aligns with constitution and spec.
- Alternatives considered: User-defined timezones (not needed MVP).

## Open Items

None (best-guess defaults applied per request).
